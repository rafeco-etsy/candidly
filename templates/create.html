{% extends "base.html" %}

{% block title %}Create Feedback Request - Candidly{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card shadow">
            <div class="card-header bg-primary text-white">
                <h4 class="mb-0">
                    <i class="fas fa-plus me-2"></i>Create Feedback Request
                </h4>
            </div>
            <div class="card-body">
                {% if templates %}
                    <form method="POST">
                        <div class="mb-4">
                            <label for="target_name" class="form-label">Person being reviewed</label>
                            <input type="text" class="form-control" id="target_name" name="target_name" required>
                            <div class="form-text">Enter the name of the person who will receive this feedback.</div>
                        </div>

                        <div class="mb-4">
                            <label for="target_email" class="form-label">Email (optional)</label>
                            <input type="email" class="form-control" id="target_email" name="target_email">
                            <div class="form-text">Email address of the person being reviewed (for future notification features).</div>
                        </div>

                        <div class="mb-4">
                            <label for="context" class="form-label">Relationship Context (optional)</label>
                            <textarea class="form-control" id="context" name="context" rows="3" 
                                      placeholder="e.g., This person recently started reporting to [target name], [target name] was just promoted to team lead, This person is a product manager giving feedback about an engineer on their team..."></textarea>
                            <div class="form-text">
                                Describe the relationship between the feedback giver and the person being reviewed. This helps the AI ask more relevant follow-up questions and provide better coaching guidance.
                            </div>
                        </div>

                        {% if users|length > 1 %}
                        <div class="mb-4">
                            <label for="assigned_to_id" class="form-label">Assign to</label>
                            <select class="form-select" id="assigned_to_id" name="assigned_to_id">
                                {% for user in users %}
                                <option value="{{ user.id }}" {% if user.id == current_user.id %}selected{% endif %}>
                                    {{ user.name }} ({{ user.email }})
                                    {% if user.id == current_user.id %} - You{% endif %}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="form-text">
                                Choose who should complete this feedback request. 
                                {% if not current_user.can_create_requests_for_others %}
                                You can only assign feedback requests to yourself.
                                {% endif %}
                            </div>
                        </div>
                        {% endif %}

                        <div class="mb-4">
                            <label for="reviewer_id" class="form-label">Reviewer (optional)</label>
                            <select class="form-select" id="reviewer_id" name="reviewer_id">
                                <option value="">No reviewer - deliver feedback directly</option>
                                {% for user in users %}
                                <option value="{{ user.id }}">
                                    {{ user.name }} ({{ user.email }})
                                    {% if user.id == current_user.id %} - You{% endif %}
                                </option>
                                {% endfor %}
                            </select>
                            <div class="form-text">
                                Optionally assign a reviewer to approve the feedback before it's delivered to the target person.
                            </div>
                        </div>

                        <div class="mb-4">
                            <label for="template_id" class="form-label">Feedback Template</label>
                            <select class="form-select" id="template_id" name="template_id" required>
                                <option value="">Choose a template...</option>
                                {% for template in templates %}
                                <option value="{{ template.id }}" 
                                        {% if request.args.get('template') == template.id %}selected{% endif %}>
                                    {{ template.name }} ({{ template.questions|length }} questions)
                                </option>
                                {% endfor %}
                            </select>
                            <div class="form-text">
                                Select a pre-configured set of questions. 
                                <a href="{{ url_for('list_templates') }}">Manage templates</a>
                            </div>
                        </div>

                        <div class="d-grid gap-2 d-md-flex justify-content-md-end">
                            <a href="{{ url_for('index') }}" class="btn btn-outline-secondary me-md-2">Cancel</a>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-save me-2"></i>Create Request
                            </button>
                        </div>
                    </form>
                {% else %}
                    <div class="text-center py-5">
                        <i class="fas fa-file-alt fa-3x text-muted mb-3"></i>
                        <h5 class="text-muted">No templates available</h5>
                        <p class="text-muted mb-4">You need to create a feedback template first.</p>
                        <a href="{{ url_for('create_template') }}" class="btn btn-success">
                            <i class="fas fa-plus me-2"></i>Create Your First Template
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock %}